% last updated in April 2002 by Antje Endemann
% Based on CVPR 07 and LNCS, with modifications by DAF, AZ and elle, 2008 and AA, 2010, and CC, 2011; TT, 2014; AAS, 2016

\documentclass[runningheads]{llncs}
%\usepackage[markup=underlined]{changes}
\usepackage{graphicx}
\usepackage{amsmath,amssymb} % define this before the line numbering.
%\usepackage{ruler}
\usepackage{color}
\usepackage[width=122mm,left=12mm,paperwidth=146mm,height=193mm,top=12mm,paperheight=217mm]{geometry}
\usepackage[pagebackref=false,breaklinks=true,letterpaper=true,colorlinks,urlcolor=blue,citecolor=blue,linkcolor=blue,bookmarks=false]{hyperref}
\usepackage{url}
\usepackage{paralist}
\usepackage{subfig}
\usepackage{booktabs}
\usepackage{makecell}
\usepackage{gensymb}
\usepackage{pifont}
\newcommand{\cmark}{\ding{51}}%
\newcommand{\xmark}{\ding{55}}%

\include{macro}

% JB: Remove all comments by setting \final to 1
\newcommand{\final}{1}

\ifthenelse{\equal{\final}{1}}
{
\renewcommand{\jiabin}[1]{}
\renewcommand{\james}[1]{}
\renewcommand{\minghsuan}[1]{}
}
{}

\makeatletter
\newcommand{\printfnsymbol}[1]{%
  \textsuperscript{\@fnsymbol{#1}}%
}
\makeatother

\begin{document}
% \renewcommand\thelinenumber{\color[rgb]{0.2,0.5,0.8}\normalfont\sffamily\scriptsize\arabic{linenumber}\color[rgb]{0,0,0}}
% \renewcommand\makeLineNumber {\hss\thelinenumber\ \hspace{6mm} \rlap{\hskip\textwidth\ \hspace{6.5mm}\thelinenumber}}
% \linenumbers

\pagestyle{headings}
\mainmatter
\def\ECCV18SubNumber{153}  % Insert your submission number here

\title{Diverse Image-to-Image Translation via Disentangled Representations} 

%\titlerunning{ECCV-18 submission ID \ECCV18SubNumber}

%\authorrunning{ECCV-18 submission ID \ECCV18SubNumber}
\author{Hsin-Ying Lee\thanks{equal contribution}$^1$, Hung-Yu Tseng\printfnsymbol{1}$^1$, Jia-Bin Huang$^2$, Maneesh Singh$^3$, Ming-Hsuan Yang$^{1,4}$}
\institute{$^1$University of California, Merced\hspace{5pt}$^2$Virginia Tech \hspace{5pt}$^3$Verisk Analytics\hspace{5pt}$^4$Google Cloud}
%\author{Anonymous ECCV submission}
%\institute{Paper ID \ECCV18SubNumber}

\maketitle

%-------------------------------------------------------------
\vspace{-7mm}
\begin{figure}[th]
\centering 
\mpage{0.535}{
\tb{Photo to van Gogh}\\
\includegraphics[width=\linewidth]{Figures/teaser_1_1.pdf} \\
\tb{Winter to summer}\\
\includegraphics[width=\linewidth]{Figures/teaser_1_2.pdf} \\
\tb{Photograph to portrait}\\
\includegraphics[width=\linewidth]{Figures/teaser_1_4.pdf} \\
 \hfill \\
} 
\hfill
\mpage{0.43}
{
%\tb{Attribute transfer}

\mpage{0.3}{Content}\hfill\mpage{0.3}{Attribute}\hfill\mpage{0.3}{Generated}
\includegraphics[width=\linewidth]{Figures/teaser_2_2.pdf} \\
}
\vspace{-5.5mm}

\mpage{0.52}{
\mpage{0.25}{Input}\hfill\mpage{0.7}{Output}
}
\hfill
\mpage{0.45}{
\mpage{0.65}{Input}\hfill\mpage{0.3}{Output}
}

 \vspace{-5mm}
    \caption{\textbf{Unpaired diverse image-to-image translation.}
    %
    (\textit{\(Left\)}) Our model learns to perform diverse translation between two collections of images without aligned training pairs.
    %
    (\textit{\(Right\)}) Example-guided translation.
    % Our model can also perform translation with a given attribute from an example image.
    %
    }
    \vspace{-13mm}
    \label{figure:teaser}
\end{figure}

%-------------------------------------------------------------
\begin{abstract}
Image-to-image translation aims to learn the mapping between two visual domains.
%
There are two main challenges for many applications: 
1) the lack of aligned training pairs and 
2) multiple possible outputs from a single input image.
%
In this work, we present an approach based on disentangled representation for producing diverse outputs without paired training images.
%
To achieve diversity, we propose to embed images onto two spaces: 
a domain-invariant content space capturing shared information across domains and a domain-specific attribute space.
%
Our model takes the encoded content features extracted from a given input and the attribute vectors sampled from the attribute space to produce diverse outputs at test time.
%
To handle unpaired training data, we introduce a novel cross-cycle consistency loss based on disentangled representations.
%
Qualitative results show that our model can generate diverse and realistic images on a wide range of tasks without paired training data.
%
For quantitative comparisons, we measure realism with user study and diversity with a perceptual distance metric.
%
We apply the proposed model to domain adaptation and show competitive performance when compared to the state-of-the-art on the MNIST-M and the LineMod datasets. 
%
%\keywords{Image-to-Image Translation, Disentangled Representation}
\end{abstract}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%    Introduction    %%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%-------------------------------------------------------------
\begin{figure}[t]
\centering
	\begin{minipage}{0.31\textwidth}
    \subfloat[CycleGAN~\cite{zhu2017cyclegan}]{
    \includegraphics[width=\linewidth]{Figures/illustration_CYCLE.pdf}
    }
    \end{minipage}
	\hfill
    \begin{minipage}{0.31\textwidth}
	\subfloat[UNIT~\cite{liu2017unit}]{
    \includegraphics[width=\linewidth]{Figures/illustration_UNIT.pdf}
    }
    \end{minipage}
	\hfill	
	\begin{minipage}{0.31\textwidth}
    \subfloat[Ours]{
    \includegraphics[width=\linewidth]{Figures/illustration.pdf}
    }
    \end{minipage}
    \caption{ 
    \textbf{Comparisons of unsupervised I2I translation methods.}
    % \textbf{Illustration of the proposed disentangled representation.} 
    % \jiabin{Imprecise title.}
    %
    Denote $x$ and $y$ as images in domain $\mathcal{X}$ and $\mathcal{Y}$: 
    %
    (a) CycleGAN~\cite{zhu2017cyclegan} maps $x$ and $y$ onto \emph{separated} latent spaces.
    %
    (b) UNIT~\cite{liu2017unit} assumes $x$ and $y$ can be mapped onto a  \emph{shared} latent space.
    %
    (c) Our approach disentangles the latent spaces of $x$ and $y$ into a shared content space $\mathcal{C}$ and an attribute space $\mathcal{A}$ of each domain.
    % 	
    % \jiabin{Add UNIT, DiscoGAN, CycleGAN, DualGAN, DTN, StarGAN}
    }
    \vspace{\figmargin}
    \label{figure:assumption}
\end{figure}

%-------------------------------------------------------------
\vspace{\secmargin}
\section{Introduction}
\label{sec:introduction}
\vspace{\secmargin}
Image-to-Image (I2I) translation aims to learn the mapping between different visual domains. 
%
Many vision and graphics problems can be formulated as I2I translation problems, such as colorization~\cite{larsson2016colorization,zhang2016colorization2} (grayscale $\rightarrow$ color), super-resolution~\cite{ledig2016photo,lai2017deep,li2016deep} (low-resolution $\rightarrow$ high-resolution), and photorealistic image synthesis~\cite{chen2017photographic,wang2017pix2pixhd} (label $\rightarrow$ image).
%
Furthermore, I2I translation has recently shown promising results in facilitating domain adaptation~\cite{bousmalis2017unsupervisedda,shrivastava2017apple,hoffman2017cycada,murez2018image}.

%\Paragraph{I2I translation is difficult for two main reasons. First, paired data is usually not applicable and the translation is even not well-defined. Second, many mappings are by nature one-to-many, which is hard to model especially on high dimensional data.}
Learning the mapping between two visual domains is challenging for two main reasons. 
%
First, aligned training image pairs are either difficult to collect (\eg day scene $\leftrightarrow$ night scene) or do not exist (\eg artwork $\leftrightarrow$ real photo).
%
Second, many such mappings are inherently multimodal --- a single input may correspond to multiple possible outputs.
% 
% \jiabin{Why this is LOW-DIMENSIONAL? For example, people usually use 100-dim vector. Is this low-dim?}
To handle multimodal translation, one possible approach is to inject a random noise vector to the generator for modeling the data distribution in the target domain. 
% low-dimensional latent vectors are commonly used along with input images to model the distribution of the target domain.
%
However, mode collapse may still occur easily since the generator often ignores the additional noise vectors.

%\Paragraph{Pix2pix can learn the mapping but generate single output conditioned on input and need paired data. BicycleGAN can generate multimodal results but still need paired data. On the other hand, CycleGan and UNIT can learn from unpaired data but fail to have diverse outputs.}
Several recent efforts have been made to address these issues.
%
{Pix2pix}~\cite{isola2017pix2pix} applies conditional generative adversarial network to I2I translation problems.
%
Nevertheless, the training process requires paired data.
%
A number of recent work~\cite{zhu2017cyclegan,liu2017unit,yi2017dualgan,taigman2016unsupervised,choi2017stargan} relaxes the dependency on paired training data for learning I2I translation. 
%
% \jiabin{Cite others: UNIT, DiscoGAN, CycleGAN, DualGAN, DTN, StarGAN so that it's clear that you are tackling a new problem, not just an incremental work over CycleGAN/UNIT.}
%
These methods, however, produce a single output conditioned on the given input image.
%
As shown in~\cite{isola2017pix2pix,zhu2017bicyclegan}, simply incorporating noise vectors as additional inputs to the generator does not lead the increased variations of the generated outputs due to the mode collapsing issue.
%
The generators in these methods are inclined to overlook the added noise vectors.
%
Very recently, {BicycleGAN}~\cite{zhu2017bicyclegan} tackles the problem of generating diverse outputs in I2I problems by encouraging the one-to-one relationship between the output and the latent vector.
%
% \jiabin{Need to explain what BicycleGAN is. Here is the main idea from their abstract: 
% ``A generator learns to map the given input, combined with this latent code, to the output. We explicitly encourage the connection between output and the latent code to be invertible. This helps prevent a many-to-one mapping from the latent code to the output during training''
% }
%
Nevertheless, the training process of {BicycleGAN} requires paired images.

%\Paragraph{ High-level intuition: We propose Disentangled Representation Image-to-Image Translation that disentangles two spaces }
In this paper, we propose a disentangled representation framework for learning to generate \emph{diverse} outputs with \emph{unpaired} training data.
%
Specifically, we propose to embed images onto two spaces: 
1) a domain-invariant content space and 2) a domain-specific attribute space as shown in \figref{assumption}.
%
% \jiabin{Take a closer look at each word. For example, here you say ``two disentangled spaces''. The "disentangled" describes "spaces". This means that you have two spaces and each of them are disentangled. This leads the readers to think that you have FOUR spaces, instead of two.}
%
% \jiabin{Either you want to use SHARED/SEPERATED or Domain-invariant/Domain-specific for describing contrastive concepts. Using mixed terms (e.g., common vs. domain-specific) may confuse readers and make the paper difficult to read.}
%
Our generator learns to perform I2I translation conditioned on content features and a latent attribute vector. 
%
The domain-specific attribute space aims to model the variations within a domain given the same content, while the domain-invariant content space captures information across domains.
%To enable diverse output generation, we encourage the latent vector and the corresponding outputs to be invertible and thereby avoid many-to-one mappings.
% 
We achieve this representation disentanglement by applying a content adversarial loss to encourage the content features \emph{not} to carry domain-specific cues, and a latent regression loss to encourage the invertible mapping between the latent attribute vectors and the corresponding outputs.
%and a reconstruction loss (for modeling the diverse variations within each domain).
%
To handle unpaired datasets, we propose a \textit{cross-cycle consistency loss} using the disentangled representations.
%
Given a pair of unaligned images, we first perform a cross-domain mapping to obtain intermediate results by swapping the attribute vectors from both images.
%
We can then reconstruct the original input image pair by applying the cross-domain mapping one more time and use the proposed cross-cycle consistency loss to enforce the consistency between the original and the reconstructed images. 
% Applying the cross-domain mapping one more time, we can reconstruct the original input image pair and enforce the cross-cycle consistency loss to minimize the deviation
%
% The cross-cycle consistency loss penalizes the 
% \jiabin{So? Where is the loss? }
%
At test time, we can use either 
1) randomly sampled vectors from the attribute space to generate diverse outputs or 
2) the transferred attribute vectors extracted from existing images for example-guided translation.
% provide desired attributes from existing images.
%
% \jiabin{1) "Sample", verb or adj? 2) you have two VERBS (use + provide) in one sentence.}
\figref{teaser} shows examples of the two testing modes.
% We present several examples in \figref{teaser}.

% ===\
%\Paragraph{Qualitative. Quantitative (diversity, realism). Domain adaptation}
We evaluate the proposed model through extensive qualitative and quantitative evaluation.
%
% We apply our model to several I2I tasks without paired training data.
%
In a wide variety of I2I tasks, we show diverse translation results with randomly sampled attribute vectors and example-guided translation with transferred attribute vectors from existing images.
% , and also show attribute transfer with images of desired attributes.
%
% \jiabin{attribute transfer is a bit vague and it does not say this is a translation method. Consider to replace that with example-guided I2I translation.}
%
We evaluate the realism of our results with a user study and the diversity using perceptual distance metrics~\cite{zhang2018perceptual}.
% To measure the performance, we conduct a user study for realism and use perceptual distance metric~\cite{zhang2018perceptual} for diversity.
%
Furthermore, we demonstrate the potential application of unsupervised domain adaptation.
%
On the tasks of adapting domains from MNIST~\cite{lecun1998MNIST} to MNIST-M~\cite{ganin2016MNISTM} and Synthetic Cropped LineMod to Cropped LineMod~\cite{hinterstoisser2012linemod,wohlhart2015croplinemod}, we show competitive performance against state-of-the-art domain adaptation methods.
 
% We perform classification and pose estimation on MNIST~\cite{lecun1998MNIST} to MNIST-M~\cite{ganin2016MNISTM}, and Synthetic Cropped LineMod to Cropped LineMod~\cite{hinterstoisser2012linemod,wohlhart2015croplinemod}.
% %
% \jiabin{No mental correspondence problem.}
% We show competitive performance against state-of-the-art domain adaptation methods.

%-------------------------------------------------------------
\begin{table}[t]
	\caption{\textbf{Feature-by-feature comparison of image-to-image translation networks.} Our model achieves multimodal translation without using aligned training image pairs.}
 	\label{tab:related_work}
	\centering
	\begin{tabular}{l ccccc} 
    	\toprule
Method & 
Pix2Pix~\cite{isola2017pix2pix} \ \ & CycleGAN~\cite{zhu2017cyclegan} \ \ & 
UNIT~\cite{liu2017unit} \ \ &
BicycleGAN~\cite{zhu2017bicyclegan} \ \ & 
Ours \ \  \\
        \midrule
        Unpaired& - & \cmark& \cmark&-& \cmark\\
        Multimodal&-&-&-& \cmark& \cmark\\
		\bottomrule
	\end{tabular}
    \vspace{\tabmargin}
    \vspace{-3mm}
\end{table}
%-------------------------------------------------------------

%\Paragraph{We make the following contributions in this work: 1. First to achieve unpaired multimodal image-to-image translation by disentangling content and style. 2. We propose a cross-cycle consistency loss and content adversarial loss 3. Can be used in domain adaptation.}
We make the following contributions:

1) We introduce a disentangled representation framework for image-to-image translation. 
%
We apply a content discriminator to facilitate the factorization of domain-invariant content space and domain-specific attribute space, and a cross-cycle consistency loss that allows us to train the model with unpaired data.
%
% \jiabin{Fix inconsistent terms.}
%
%To the best of our knowledge, we are the first to explore \textit{multimodal} I2I translation using \textit{unpaired} data.

2)
Extensive qualitative and quantitative experiments show that our model compares favorably against existing I2I models.
%
Images generated by our model are both diverse and realistic.

%
3)
We demonstrate the application of our model on unsupervised domain adaptation.
%
We achieve competitive results on both the MNIST-M and the Cropped LineMod datasets.
%

Our code, data and more results are available at \url{https://github.com/HsinYingLee/DRIT/}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%    Related Work    %%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Related Work}
\label{sec:related}
\vspace{-1mm}
\vspace{\secmargin}
%%%%%%%%%%%%%%%%%%%%
%%%Generative Adversarial Network
%%%%%%%%%%%%%%%%%%%%
% \jiabin{For ALL paragraphs and subsection titles. Only use CAP for the first letter. Be consistent.}
\Paragraph{Generative adversarial networks.}
Recent years have witnessed rapid progress on generative adversarial networks (GANs)~\cite{goodfellow2014GAN,radford2016dcgan,arjovsky2017wgan} for image generation.
%
The core idea of GANs lies in the adversarial loss that enforces the distribution of generated images to match that of the target domain.
% 
The generators in GANs can map from noise vectors to realistic images.
% 
Several recent efforts explore \emph{conditional} GAN in various contexts including conditioned on text~\cite{reed2016text2img}, low-resolution images~\cite{ledig2016photo}, video frames~\cite{vondrick2016videogan}, and image~\cite{isola2017pix2pix}.
% \jiabin{"context" or "contexts"? Read what you wrote with a critical eye.}
% 
Our work focuses on using GAN conditioned on an input image.
%
In contrast to several existing conditional GAN frameworks that require paired training data, our model produces diverse outputs without paired data.
%
This suggests that our method has wider applicability to problems where paired training datasets are scarce or not available.

\vspace{\paramargin}
%%%%%%%%%%%%%%%%%%%%
%%% Image-to-Image Translation
%%%%%%%%%%%%%%%%%%%%
\Paragraph{Image-to-image translation.}
I2I translation aims to learn the mapping from a source image domain to a target image domain.
% 
% \jiabin{Again, you are not thinking clearly when you wrote THE/A. If you are not referring to a PARTICULAR source/target domain, you should not use THE.}
%
Pix2pix~\cite{isola2017pix2pix} applies a conditional GAN to model the mapping function.
%
Although high-quality results have been shown, the model training requires paired training data. 
%
To train with unpaired data, CycleGAN~\cite{zhu2017cyclegan}, DiscoGAN~\cite{kim2017discogan}, and UNIT~\cite{liu2017unit} leverage cycle consistency to regularize the training.
%
However, these methods perform generation conditioned solely on an input image and thus produce one single output.
% \jiabin{Abuse of the technical term "deterministic". Even adding a noise vector, the generation is still deterministic. This is in contrast to "probabilistic" where the model generates a DISTRIBUTION, not a POINT ESTIMATE.}
% JB: WHY not effective? Why generator tend to ignore noise vector? The descriptions do not touch the core concepts. 
Simply injecting a noise vector to a generator is usually not an effective solution to achieve multimodal generation due to the lack of regularization between the noise vectors and the target domain. 
% often causes the generator to focus on input images only and ignore noise vectors.
%
On the other hand, BicycleGAN~\cite{zhu2017bicyclegan} enforces the bijection mapping between the latent and target space to tackle the mode collapse problem.
%
Nevertheless, the method is only applicable to problems with paired training data. 
%
Table~\ref{tab:related_work} shows a feature-by-feature comparison among various I2I models. 
%
Unlike existing work, our method enables I2I translation with diverse outputs in the absence of paired training data.
%

Very recently, several concurrent works~\cite{almahairi2018augmented,huang2018munit,cao2018dida,ma2018exemplar} (all independently developed) also adopt a disentangled representation similar to our work for learning diverse I2I translation from unpaired training data.
%
We encourage the readers to review these works for a complete picture.
%
% \jiabin{DiDA~\cite{cao2018dida} also has domain adaptation.}
% Our work differs in that we apply a content discriminator and demonstrate the application to domain adaptation.
%
%However, MUNIT~\cite{huang2018munit} leverage Adaptive Instance Normalization~\cite{huang2017adain} layers while we take advantage of a 
\vspace{\paramargin}

%%%%%%%%%%%%%%%%%%%%
%%% Disentangled Representations
%%%%%%%%%%%%%%%%%%%%
\Paragraph{Disentangled representations.}
%
The task of learning disentangled representation aims at modeling the factors of data variations.
% with separated latent vectors.
% \jiabin{How is disentangled representation a TASK?}
%Previous work leverages labeled data to factor representations into class-related and class-independent with cross-covariance~\cite{cheung2014discovering}, VAE~\cite{kingma2014semi}, autoencoders~\cite{makhzani2015adversarial}, and conditional GAN~\cite{mathieu2016disentangling}.
Previous work makes use of labeled data to factorize representations into class-related and class-independent components~\cite{cheung2014discovering,kingma2014semi,makhzani2015adversarial,mathieu2016disentangling}.
%
Recently, the unsupervised setting has been explored~\cite{chen2016infogan,denton2017unsupervised}.
%
InfoGAN~\cite{chen2016infogan} achieves disentanglement by maximizing the mutual information between latent variables and data variation.
%
Similar to DrNet~\cite{denton2017unsupervised} that separates time-independent and time-varying components with an adversarial loss, we apply a content adversarial loss to disentangle an image into domain-invariant and domain-specific representations to facilitate learning diverse cross-domain mappings. 

\vspace{\paramargin}
%%%%%%%%%%%%%%%%%%%%
%%% Domain Adaptation
%%%%%%%%%%%%%%%%%%%%
\Paragraph{Domain adaptation.}
Domain adaptation techniques focus on addressing the domain-shift problem between a source and a target domain.
%
Domain Adversarial Neural Network (DANN)~\cite{ganin2015unsupervised,ganin2016domain} and its variants~\cite{tzeng2014deep,bousmalis2016domain,Tsai_adaptseg_2018} tackle domain adaptation through learning domain-invariant features.
% are trained to find domain-invariant features.
% \jiabin{Avoid passive form}
%
Sun~\etal~\cite{sun2016return} aims to map features in the source domain to those in the target domain. 
%
I2I translation has been recently applied to produce simulated images in the target domain by translating images from the source domain~\cite{ganin2015unsupervised,hoffman2017cycada}.
%
%Different from typical domain adaptation algorithms that take annotations of source domain into consideration, the proposed model performs image-to-image translation only and obtain comparable performance.
Different from the aforementioned I2I based domain adaptation algorithms, our method does not utilize source domain annotations for I2I translation. 
%that take annotations of source domain into consideration, the proposed model performs image-to-image translation only and obtain comparable performance.
%Different from typical domain adaptation algorithms that take annotations of source domain into consideration, the proposed model performs image-to-image translation only and obtain comparable performance.
%
% JB: What's the RELATIONSHIP between our work and the papers you mention? Do they also perform I2I?
%Our method can further expand the training set by diverse translation.

%-------------------------------------------------------------
\begin{figure*}[t]
	\centering
	\subfloat[Training with unpaired images]{%
		\includegraphics[width=0.95\linewidth]{Figures/architecture2.pdf}%
	}
    
    \begin{minipage}[b]{0.491\textwidth}
    \subfloat[Testing with random attributes]{%
		\includegraphics[width=\linewidth]{Figures/architecture_inference_random2.pdf}%
	}
    \end{minipage}
    \hspace{4mm}
    \begin{minipage}[b]{0.409\textwidth}
    \subfloat[Testing with a given attribute ]{%
		\includegraphics[width=\linewidth]{Figures/architecture_inference_encoded2.pdf}%
	}
    \end{minipage}
    \caption{\textbf{Method overview.} (a) With the proposed content adversarial loss $L_\mathrm{adv}^\mathrm{content}$ (Section~\ref{subsec:conadv}) and the cross-cycle consistency loss $L_1^\mathrm{cc}$ (Section~\ref{subsec:crosscycle}), we are able to learn the multimodal mapping between the domain $\mathcal{X}$ and $\mathcal{Y}$ with unpaired data. 
    % More details of $L_\mathrm{adv}^\mathrm{content}$ and $L_1^\mathrm{cc}$ are given in Section~\ref{subsec:conadv} and~\ref{subsec:crosscycle}, respectively. 
    % \jiabin{Avoid asking reader to solve mental correspondence problems}
    Thanks to the proposed disentangled representation, we can generate output images conditioned on either (b) random attributes or (c) a given attribute at test time.}
    \label{figure:architecture}
    \vspace{\figmargin}
\end{figure*}
%-------------------------------------------------------------

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%   Framework    %%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% JB: Please use more specific section name than FRAMEWORK
\section{Disentangled Representation for I2I Translation}
\label{sec:framework}
\vspace{\secmargin}
%
Our goal is to learn a multimodal mapping between two visual domains $\mathcal{X} \subset \mathbb{R}^{H\times W \times 3}$ and $\mathcal{Y} \subset \mathbb{R}^{H\times W \times 3}$ without paired training data.
%
As illustrated in~\figref{architecture}, our framework consists of content encoders $\{E^c_\mathcal{X}, E^c_\mathcal{Y}\}$, attribute encoders $\{E^a_\mathcal{X}, E^a_\mathcal{Y}\}$, generators $\{G_\mathcal{X}, G_\mathcal{Y}\}$, and domain discriminators $\{D_\mathcal{X}, D_\mathcal{Y}\}$ for both domains, and a content discriminators $D_\mathrm{adv}^\mathrm{c}$.
%
Take domain $\mathcal{X}$ as an example, the content encoder $E^c_\mathcal{X}$ maps images onto a shared, domain-invariant content space ($E^c_\mathcal{X}:\mathcal{X}\to \mathcal{C}$) and the attribute encoder $E^a_\mathcal{X}$ maps images onto a domain-specific attribute space ($E^a_\mathcal{X}:\mathcal{X}\to \mathcal{A}_\mathcal{X}$).
%
The generator $G_\mathcal{X}$ generates images conditioned on both content and attribute vectors ($G_\mathcal{X}:\{\mathcal{C}, \mathcal{A}_\mathcal{X}\} \to \mathcal{X} $).
% 
The discriminator $D_\mathcal{X}$ aims to discriminate between real images and translated images in the domain $\mathcal{X}$.
%
Content discriminator $D^c$ is trained to distinguish the extracted content representations between two domains.
%
To enable multimodal generation at test time, we regularize the attribute vectors so that they can be drawn from a prior Gaussian distribution $\mathnormal{N}(0,1)$. 

In this section, we first discuss the strategies used to disentangle the content and attribute representations in \subsecref{conadv} and then introduce the proposed cross-cycle consistency loss that enables the training on unpaired data in \subsecref{crosscycle}. 
%
Finally, we detail the loss functions in \subsecref{learn}.

\subsection{Disentangle Content and Attribute Representations}
\label{subsec:conadv}
\vspace{\subsecmargin}
%
Our approach embeds input images onto a shared content space $\mathcal{C}$, and domain-specific attribute spaces, $\mathcal{A}_\mathcal{X}$ and $\mathcal{A}_\mathcal{Y}$.
%
Intuitively, the content encoders should encode the common information that is \emph{shared} between domains onto $\mathcal{C}$, while the attribute encoders should map the remaining domain-specific information onto $\mathcal{A}_\mathcal{X}$ and $\mathcal{A}_\mathcal{Y}$.
%
\vspace{\eqmargin}
\begin{equation}
\begin{aligned}
&\{z_x^{c},z_x^{a}\} = \{{E^c_\mathcal{X}}(x), {E^a_\mathcal{X}}(x)\}\quad&& z_x^{c}\in \mathcal{C}, z_x^{a}\in \mathcal{A}_\mathcal{X}\\
&\{z_y^{c},z_y^{a}\} = \{{E^c_\mathcal{Y}}(y), {E^a_\mathcal{Y}}(y)\}\quad&& z_y^{c}\in \mathcal{C}, z_y^{a}\in \mathcal{A}_\mathcal{Y}
\end{aligned}
\end{equation}
\vspace{\eqmargin}
%

To achieve representation disentanglement, we apply two strategies: weight-sharing and a content discriminator.
%
First, similar to~\cite{liu2017unit}, based on the assumption that two domains share a common latent space, we share the weight between the last layer of $E^c_\mathcal{X}$ and $E^c_\mathcal{Y}$ and the first layer of $G_\mathcal{X}$ and $G_\mathcal{Y}$.
%
Through weight sharing, we force the content representation to be mapped onto the same space.
% JB: WHat's contain common information only?
However, sharing the same high-level mapping functions cannot guarantee the same content representations encode the same information for both domains.
%JAMES: However, sharing the same high-level mapping functions cannot guarantee the corresponding images in both domains share the same content representations.
%
Therefore, we propose a content discriminator $D^c$ which aims to distinguish the domain membership of the encoded content features $z_x^{c}$ and $z_y^{c}$.
%
On the other hand, content encoders learn to produce encoded content representations whose domain membership cannot be distinguished by the content discriminator $D^c$.
%
We express this content adversarial loss as:
\vspace{\eqmargin}
\begin{equation}
\begin{aligned}
L_{\mathrm{adv}}^{\mathrm{content}}(E^c_\mathcal{X},E^c_\mathcal{Y}, D^c) &= \mathbb{E}_{x}[\frac{1}{2}\log{D^c(E^c_\mathcal{X}(x))}+\frac{1}{2}\log{(1-D^c(E^c_\mathcal{X}(x)))]}\\  &+ \mathbb{E}_{y}[\frac{1}{2}\log{D^c(E^c_\mathcal{Y}(y))}+\frac{1}{2}\log{(1-D^c(E^c_\mathcal{Y}(y)))}]
\end{aligned}
\end{equation}
\vspace{\eqmargin}
\vspace{\eqmargin}

\vspace{\subsecmargin}
\subsection{Cross-cycle Consistency Loss}
\label{subsec:crosscycle}
\vspace{\subsecmargin}
%Since the content space is shared, the encoded content representation is interchangeable between two domains.
%
With the disentangled representation where the content space is shared among domains and the attribute space encodes intra-domain variations, we can perform I2I translation by combining a content representation from an arbitrary image and an attribute representation from an image of the target domain.
%
We leverage this property and propose a \textit{cross-cycle consistency}.
%
In contrast to cycle consistency constraint in~\cite{zhu2017cyclegan} (\ie{$\mathcal{X} \to \mathcal{Y} \to \mathcal{X}$}) which assumes one-to-one mapping between the two domains, the proposed cross-cycle constraint exploit the disentangled content and attribute representations for cyclic reconstruction.
%
%Using the proposed cross-cycle reconstruction allows us to train our model with unpaired data.

Our cross-cycle constraint consists of two stages of I2I translation.

\noindent \textbf{Forward translation.} Given a non-corresponding pair of images $x$ and $y$,  we encode them into $\{z_x^{c}, z_x^{a}\}$ and $\{z_y^{c}, z_y^{a}\}$.
%
We then perform the first translation by swapping the attribute representation (\ie $z_x^{a}$ and $z_y^{a}$) to generate $\{u,v\}$, where $u\in \mathcal{X}, v \in \mathcal{Y}$.
%
\vspace{\eqmargin}
\begin{equation}
\begin{aligned}
u = G_\mathcal{X}(z_y^c, z_x^a)\quad
v = G_\mathcal{Y}(z_x^c, z_y^a)
\end{aligned}
\end{equation}
\vspace{\eqmargin}

\noindent \textbf{Backward translation.} After encoding $u$ and $v$ into $\{z_u^c,z_u^a\}$ and $\{z_v^c,z_v^a\}$, we perform the second translation by once again swapping the attribute representation (\ie $z_u^a$ and $z_v^a$).
%
\vspace{\eqmargin}
\begin{equation}
\begin{aligned}[c]
\hat{x} = G_\mathcal{X}(z_v^c, z_u^a)\quad
\hat{y} = G_\mathcal{Y}(z_u^c, z_v^a)
\end{aligned}
\end{equation}
\vspace{\eqmargin}

Here, after two I2I translation stages, the translation should reconstruct the original images $x$ and $y$ (as illustrated in \figref{architecture}).
%
To enforce this constraint, we formulate the \textit{cross-cycle consistency loss} as:

\vspace{\eqmargin}
\begin{equation}
\begin{aligned}
L_1^{\mathrm{cc}}(G_\mathcal{X},G_\mathcal{Y},E_\mathcal{X}^c,E_\mathcal{Y}^c,E_\mathcal{X}^a,E_\mathcal{Y}^a) = 
\mathbb{E}_{x,y}[&\lVert G_\mathcal{X}(E_\mathcal{Y}^c(v),E_\mathcal{X}^a(u) )-x \lVert_{1} \\
+ &\lVert G_\mathcal{Y}(E_\mathcal{X}^c(u),E_\mathcal{Y}^a(v) )-y \lVert_{1}],\\
\end{aligned}
\end{equation}
\vspace{\eqmargin}
where $u=G_\mathcal{X}(E_\mathcal{Y}^c(y)),E_\mathcal{X}^a(x))$ and $v=G_\mathcal{Y}(E_\mathcal{X}^c(x)),E_\mathcal{Y}^a(y))$.

%-------------------------------------------------------------
\begin{figure*}[t]
	\centering
		\includegraphics[width=\linewidth]{Figures/architecture_otherloss.pdf}%
	\caption{\textbf{Loss functions.} 
    In addition to the cross-cycle reconstruction loss $L_1^{\mathrm{cc}}$ and the content adversarial loss $L_{\mathrm{adv}}^\mathrm{content}$ described in Figure~\ref{figure:architecture}, we apply several additional loss functions in our training process. 
 %
    The self-reconstruction loss $L_1^{\mathrm{recon}}$ facilitates training with self-reconstruction;
    the KL loss $L_{\mathrm{KL}}$ aims to align the attribute representation with a prior Gaussian distribution;
    the adversarial loss $L_{\mathrm{adv}}^{\mathrm{domain}}$ encourages $G$ to generate realistic images in each domain; 
    and the latent regression loss $L_1^{\mathrm{latent}}$ enforces the reconstruction on the latent attribute vector.
    More details can be found in Section~\ref{subsec:learn}.}
	\label{figure:loss}
    \vspace{\figmargin}
\end{figure*}
%-------------------------------------------------------------

\subsection{Other Loss Functions}
\label{subsec:learn}
\vspace{\subsecmargin}
Other than the proposed content adversarial loss and cross-cycle consistency loss, we also use several other loss functions to facilitate network training.
%
We illustrate these additional losses in \figref{loss}. 
%
Starting from the top-right, in the counter-clockwise order:
%

\noindent \textbf{Domain adversarial loss.}
%
We impose adversarial loss $L_{\mathrm{adv}}^{\mathrm{domain}}$ where $D_\mathcal{X}$ and $D_\mathcal{Y}$ attempt to discriminate between real images and generated images in each domain, while $G_\mathcal{X}$ and $G_\mathcal{Y}$ attempt to generate realistic images.
%\begin{equation}
%\begin{aligned}
%L_{adv}(E_{c\_y},E_{a\_x}, G_x, D_x) = &\mathbb{E}_{x,y}[\log{D_x(x)} +\log(1-{D_x(u)})]\\
%L_{adv}(E_{c\_x},E_{a\_y}, G_y, D_y) = &\mathbb{E}_{x,y}[\log{D_y(y)} +\log(1-{D_y(v)})]\\
%\end{aligned}
%\end{equation}
%

\noindent \textbf{Self-reconstruction loss.}
In addition to the cross-cycle reconstruction, we apply a self-reconstruction loss $L_1^{\mathrm{rec}}$ to facilitate the training. 
%
With encoded content/attribute features $\{z_x^c, z_x^a\}$ and $\{z_y^c, z_y^a\}$, the decoders $G_\mathcal{X}$ and $G_\mathcal{Y}$ should decode them back to original input $x$ and $y$.
%
That is, $\hat{x} = G_\mathcal{X}(E_\mathcal{X}^c(x),E_\mathcal{X}^a(x) )$ and $\hat{y} = G_\mathcal{Y}(E_\mathcal{Y}^c(y),E_\mathcal{Y}^a(y) )$.
%That is, $L_1^{\mathrm{rec}}=\lVert G_\mathcal{X}(E_\mathcal{X}^c(x),E_\mathcal{X}^a(x) )-x \lVert_{1} +\lVert G_\mathcal{Y}(E_\mathcal{Y}^c(y),E_\mathcal{Y}^a(y) )-y \lVert_{1}$
%\begin{equation}
%\begin{aligned}
%&L_1(G_x,E_{c\_x},E_{a\_x}) &= \mathbb{E}_{x}[\lVert G_x(E_{c\_x}(x),E_{a\_x}(x) )-x \lVert_{1}] \\
%&L_1(G_y,E_{c\_y},E_{a\_y}) &= \mathbb{E}_{y}[\lVert G_y(E_{c\_y}(y),E_{a\_y}(y) )-x \lVert_{1}]
%\end{aligned}
%\end{equation}
%

\noindent \textbf{KL loss.}
In order to perform stochastic sampling at test time, we encourage the attribute representation to be as close to a prior Gaussian distribution.  
%
We thus apply the loss $L_{\mathrm{KL}}= \mathbb{E}[D_{\mathrm{KL}}((z_a)\|N(0,1))]$, where $D_{\mathrm{KL}}(p\|q)=-\int{p(z)\log{\frac{p(z)}{q(z)}}\mathrm{d}z}$.

\noindent \textbf{Latent regression loss.}
To encourage invertible mapping between the image and the latent space, we apply a latent regression loss $L_1^{\mathrm{latent}}$ similar to~\cite{zhu2017bicyclegan}. 
%
We draw a latent vector $z$ from the prior Gaussian distribution as the attribute representation and attempt to reconstruct it with $\hat{z}=E_\mathcal{X}^a(G_\mathcal{X}(E_\mathcal{X}^c(x),z))$ and $\hat{z}=E_\mathcal{Y}^a(G_\mathcal{Y}(E_\mathcal{Y}^c(y),z))$.
%
%\begin{equation}
%\begin{aligned}
%L_{lr}(G_x, G_y) &= \mathbb{E}_{x}[\lVert G_x(E_{c\_x}(x),z)-z\lVert_{1} +\mathbb{E}_{y}[\lVert %G_y(E_{c\_y}(y),z)-z\lVert_{1}]
%\end{aligned}
%\end{equation}
%
%
%\begin{equation}
%\begin{aligned}
%L_{KL}(E_{a\_x},E_{a\_y}) = \mathbb{E}_{x}[D_{KL}(E_{a\_x}(x)\|N(0,1)]+\mathbb{E}_{y}[D_{KL}(E_{a\_y}(y)\|N(0,1)]
%\end{aligned}
%\end{equation}
%

%-------------------------------------------------------------
\begin{figure*}[t]
	\centering
     \mpage{0.16}{Input}\hfill\mpage{0.8}{Generated images}
     %\mpage{0.01}{\rotatebox[origin=c]{90}{edge/shoe  winter/summer  vanGogh/monet  photo/vanGogh monet/photo}}
     %\hfill
     %\mpage{0.96}{
    \includegraphics[width=\linewidth]{Figures/Diversity2.pdf}
     % }
    \caption{\textbf{Sample results.} We show example results produced by our model. The left column shows the input images in the source domain. The other five columns show the output images generated by sampling random vectors in the attribute space. 
    % 
    The mappings from top to bottom are: Monet $\rightarrow$ photo, photo $\rightarrow$ van Gogh, van Gogh  $\rightarrow$ Monet, winter $\rightarrow$ summer, and photograph $\rightarrow$ portrait.
    }
    \label{figure:example}
    \vspace{\figmargin}
 \end{figure*}
%-------------------------------------------------------------

The full objective function of our network is:
\vspace{\eqmargin}
\begin{equation}
\begin{aligned}
\min_{G,E^c,E^a}\max_{D,D^c}\quad &\lambda_{\mathrm{adv}}^{\mathrm{content}}L_{\mathrm{adv}}^{\mathrm{c}}+\lambda_1^{\mathrm{cc}}L_1^{\mathrm{cc}} + \lambda_{\mathrm{adv}}^{\mathrm{domain}}L_{\mathrm{adv}}^{\mathrm{domain}}+ \lambda_1^{\mathrm{recon}} L_1^{\mathrm{recon}}\\
 + &\lambda_1^{\mathrm{latent}}L_1^{\mathrm{latent}}+ \lambda_{\mathrm{KL}}L_{\mathrm{KL}}
\end{aligned}
\end{equation}
\vspace{\eqmargin}
%\begin{equation}
%\begin{aligned}
%\min_{G,E^c,E^a}\max_{D,D^c}\quad &\lambda_{cadv}L_{cadv}+\lambda_{cc}L_{cc}  
%+ \lambda_{adv}L_{adv}+ \lambda_{rec} L_{rec} 
%+ \lambda_{lr}L_{lr}+ \lambda_{KL}L_{KL}
%\end{aligned}
%\end{equation}
where the hyper-parameters $\lambda$s control the importance of each term. 
%
%\begin{equation}
%\begin{aligned}
%\min_{G,E_c,E_a}\max_{D,D_c}\quad &L_{adv}(E_{c\_x},E_{c\_y}, D_c)+L_{cc}(G_x,G_y,E_{c\_x},E_{c\_y},E_{a\_x},E_{a\_y})  \\
%&+ L_{adv}(E_{c\_y},E_{a\_x}, G_x, D_x) + L_{adv}(E_{c\_x},E_{a\_y}, G_y, D_y)\\
%&+ L_1(G_x,E_{c\_x},E_{a\_x}) + L_1(G_y,E_{c\_y},E_{a\_y})\\
%&+ L_{lr}(G_x, G_y) + L_{KL}(E_{a\_x},E_{a\_y})
%\end{aligned}
%\end{equation}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%    Implementation details    %%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%

 %-------------------------------------------------------------
\begin{figure*}[t]
    \subfloat{%
	    \includegraphics[width=\linewidth]{Figures/Diversity_compare2.pdf}%
	}
	\caption{\textbf{Diversity comparison.} On the winter $\rightarrow$ summer translation task, our model produces more diverse and realistic samples over baselines.
	}
	\label{figure:diversity}
    \vspace{-4mm}
\end{figure*}
%-------------------------------------------------------------
%-------------------------------------------------------------
\begin{figure*}[t]
	\centering
	\subfloat{%
	    \includegraphics[width=\linewidth, height=3cm]{Figures/interpolation.pdf}%
	}
	\caption{\textbf{Linear interpolation between two attribute vectors.}  Translation results with linear-interpolated attribute vectors between two attributes (highlighted in red).
	}
	\label{figure:interpolation}
    \vspace{\figmargin}
\end{figure*}
%-------------------------------------------------------------
\vspace{\secmargin}
\section{Experimental Results}
\label{sec:experiments}
\vspace{\secmargin}
\vspace{-1mm}
\Paragraph{Implementation details.}
%
We implement our model with PyTorch~\cite{paszke2017pytorch}.
%
We use the input image size of $216 \times 216$ for all of our experiments except domain adaptation.
%
For the content encoder $E^c$, we use an architecture consisting of three convolution layers followed by four residual blocks.
% 
For the attribute encoder $E^a$, we use a CNN architecture with four convolution layers followed by fully-connected layers.
%
We set the size of the attribute vector to $z^a \in R^8$ for all experiments.
%
For the generator $G$, we use an architecture containing four residual blocks followed by three fractionally strided convolution layers.
%
For more details of architecture design, please refer to the supplementary material.

For training, we use the Adam optimizer~\cite{kinga2015adam} with a batch size of $1$, a learning rate of $0.0001$, and exponential decay rates $(\beta_1, \beta_2) = (0.5, 0.999)$.
%
In all experiments, we set the hyper-parameters as follows: $\lambda^{\mathrm{content}}_{\mathrm{adv}}=1$, $ \lambda_{\mathrm{cc}}=10$, $\lambda^{\mathrm{domain}}_{\mathrm{adv}}=1$, $ \lambda_1^{\mathrm{rec}} =10$,  $\lambda_1^{\mathrm{latent}}=10$, and $\lambda_{\mathrm{KL}}=0.01$. 
%
We also apply an L1 weight regularization on the content representation with a weight of $0.01$. 
%
We follow the procedure in DCGAN~\cite{radford2016dcgan} for training the model with adversarial loss.

\vspace{\paramargin}
\Paragraph{Datasets.}
%
We evaluate our model on several datasets include Yosemite~\cite{zhu2017cyclegan} (summer and winter scenes), artworks~\cite{zhu2017cyclegan} (Monet and van Gogh), edge-to-shoes~\cite{Yu2014edge2shoe} and photo-to-portrait cropped from subsets of the WikiArt dataset \footnote{\url{https://www.wikiart.org/}} and the CelebA dataset~\cite{liu2015celeb}. 
%
We also perform domain adaptation on the classification task with MNIST~\cite{lecun1998MNIST} to MNIST-M~\cite{ganin2016MNISTM}, and on the classification and pose estimation tasks with Synthetic Cropped LineMod to Cropped LineMod~\cite{hinterstoisser2012linemod,wohlhart2015croplinemod}.

\vspace{-3mm}
\vspace{\paramargin}
\Paragraph{Compared methods.}
We perform the evaluation on the following algorithms:
\begin{compactitem}
\item \tb{DRIT: } We refer to our proposed model, Disentangled Representation for Image-to-Image Translation, as DRIT.
\item \tb{DRIT w/o $D^c$: } Our proposed model without the content discriminator.
\item\tb{CycleGAN}~\cite{zhu2017cyclegan}, \tb{UNIT}~\cite{liu2017unit}, \tb{BicycleGAN}~\cite{zhu2017bicyclegan}
\item \tb{Cycle/Bicycle: } As there is no previous work addressing the problem of multimodal generation from unpaired training data, we construct a baseline using a combination of CylceGAN and BicycleGAN. Here, we first train CycleGAN on unpaired data to generate corresponding images as \emph{pseudo} image pairs. We then use this pseudo paired data to train BicycleGAN.
\end{compactitem}


%-------------------------------------------------------------
\begin{figure}[t]
	\centering
	\subfloat[Inter-domain attribute transfer]{%
    	\mpage{0.45}{
    		\mpage{0.28}{Content}\hfill\mpage{0.28}{Attribute}\hfill\mpage{0.3}{Output}
			\includegraphics[width=\linewidth]{Figures/ContentAttribute_Cross2.pdf}%
        }
     }
  %  }
    \hfill
    \subfloat[Intra-domain attribute transfer]{%
          \mpage{0.45}{
     	\mpage{0.28}{Content}\hfill\mpage{0.28}{Attribute}\hfill\mpage{0.3}{Output}
		\includegraphics[width=\linewidth]{Figures/ContentAttribute_Same2.pdf}%
	   }
    }
	\caption{\textbf{Attribute transfer.} At test time, in addition to random sampling from the attribute space, we can also perform translation with the query images with the desired attributes. Since the content space is shared across the two domains, we not only can achieve (a) inter-domain, but also (b) intra-domain attribute transfer. Note that we do not explicitly involve intra-domain attribute transfer during training.
	}
	\label{figure:cross}
    \vspace{\figmargin}
\end{figure}
%-------------------------------------------------------------


%-------------------------------------------------------------
\begin{figure*}[t]
	\centering
    \includegraphics[width=\linewidth]{Figures/realism.pdf}
    \caption{\textbf{Realism preference results.} 
    We conduct a user study to ask subjects to select results that are \emph{more realistic} through pairwise comparisons.
    The number indicates the percentage of preference on that comparison pair. 
    We use the winter $\rightarrow$ summer translation on the Yosemite dataset for this experiment.}
    \label{figure:realism}
    \vspace{-5mm}
 \end{figure*}
%-------------------------------------------------------------
%-------------------------------------------------------------
\begin{table}[tb]
    \begin{minipage}[t]{.45\linewidth}
      \caption{\textbf{Diversity.} We use the LPIPS metric~\cite{zhang2018perceptual} to measure the diversity of generated images on the Yosemite dataset. 
      }
	\label{tab:diversity}
      \centering
    \begin{tabular}{l c}
    \toprule
    Method & Diversity \\
    \midrule
    real images & .448 $\pm$ .012 \\
    \midrule
    DRIT &  \textbf{.424} $\pm$ .010 \\
    DRIT w/o $D^c$ & .410  $\pm$ .016\\
    UNIT~\cite{liu2017unit} & .406 $\pm$ .022\\
    CycleGAN~\cite{zhu2017cyclegan} & \underline{.413} $\pm$ .008\\
    Cycle/Bicycle & .399 $\pm$ .009\\
    \bottomrule
    \end{tabular}
    \end{minipage}%
    \hfill
    \begin{minipage}[t]{.45\linewidth}
        \caption{\textbf{Reconstruct error}. We use the edge-to-shoes dataset to measure the quality of our attribute encoding. The reconstruction error is $\lVert y-G_\mathcal{Y}(E_\mathcal{X}^c(x), E_\mathcal{Y}^a(y))\lVert_{1}$. * BicycleGAN uses \emph{paired} data for training.
}
	\label{tab:recon}
    \centering
	\begin{tabular}{l cc} 
    	\toprule
		Method & Reconstruct error\\
        \midrule
        BicycleGAN~\cite{zhu2017bicyclegan}* & \textbf{0.0945} \\
        \midrule 
        DRIT & \underline{0.1347}\\
        DRIT,  w/o $D^c$& 0.2076\\
		\bottomrule
	\end{tabular}
    \end{minipage} 
    \vspace{-1mm}
\end{table}



\subsection{Qualitative Evaluation}
%\vspace{\subsecmargin}
\vspace{-1mm}
\Paragraph{Diversity.} We first demonstrate the diversity of the generated images on several different tasks in \figref{example}.
%
In \figref{diversity}, we compare the proposed model with other methods. 
%
Both our model without $D^c$ and Cycle/Bicycle can generate diverse results. 
%
However, the results contain clearly visible artifacts. 
% JB: Need to describe the following better.
Without the content discriminator, our model fails to capture domain-related details (\eg the color of tree and sky).
%
Therefore, the variations take place in global color difference.
%our model fails to isolate desirable domain-specific attributes.
% Need to rewrite this
%Thus, the translation results in only global color difference instead of details variations.
%
Cycle/Bicycle is trained on pseudo paired data generated by CycleGAN.
%
The quality of the pseudo paired data is not uniformly ideal.
%
As a result, the generated images are of ill-quality.
%
%
%We can also tell that without the content discriminator our model can generate diverse outputs to some extent.
%
%Nevertheless, the content discriminator helps facilitate the disentanglement of the shared content and the domain-specific attribute, thus improve the diversity of generated images.
%
%More qualitative results are provided in the supplementary material.

To have a better understanding of the learned domain-specific attribute space, we perform linear interpolation between two given attributes and generate the corresponding images as shown in \figref{interpolation}.
% JB: What??? (黑人問號)
The interpolation results verify the continuity in the attribute space and show that our model can generalize in the distribution, rather than memorize trivial visual information.

\vspace{\paramargin}
\Paragraph{Attribute transfer.} 
%
We demonstrate the results of the attribute transfer in \figref{cross}.
%
Thanks to the representation disentanglement of content and attribute, we are able to perform attribute transfer from images of desired attributes, as illustrated in \figref{architecture}(c).
%
Moreover, since the content space is shared between two domains, we can generate images conditioned on content features encoded from either domain.
%
Thus our model can achieve not only inter-domain but also intra-domain attribute transfer.
%
Note that intra-domain attribute transfer is not explicitly involved in the training process.
%
%Nevertheless, \figref{cross}(b) shows that our method obtains high-quality results.




\subsection{Quantitative Evaluation}
 \vspace{\subsecmargin}
\Paragraph{Realism \vs diversity.} 
%
Here we have the quantitative evaluation on the realism and diversity of the generated images.
%
We conduct the experiment using winter $\rightarrow$ summer translation with the Yosemite dataset.
%
For realism, we conduct a user study using pairwise comparison.
%
Given a pair of images sampled from real images and translated images generated from various methods, users need to answer the question  ``Which image is more realistic?''
%
For diversity, similar to~\cite{zhu2017bicyclegan}, we use the LPIPS metric~\cite{zhang2018perceptual} to measure the similarity among images.
%
We compute the distance between 1000 pairs of randomly sampled images translated from 100 real images.
%

\figref{realism} and \tabref{diversity} show the results of realism and diversity, respectively.
%
%
UNIT obtains low realism score, suggesting that their assumption might not be generally applicable.
% 
CycleGAN achieves the highest scores in realism, yet the diversity is limited.
%
The diversity and the visual quality of Cycle/Bicycle are constrained by the data CycleGAN can generate.
%
Our results also demonstrate the need for the content discriminator.
%
% Our model performs better with the content discriminator in both diversity and realism.

%-------------------------------------------------------------
%\begin{table}[tbh]
%	\caption{\textbf{Realism preference.} We present two images from different methods to users, and ask them to select the more realistic one. The number indicates the percentage of preference on that comparison combination. We use the Yosemite dataset for this experiment.}
%	\label{tab:realism_diversity}
%	\centering
%	\small
%	\begin{tabular}{l c} 
 %   	\toprule
%		Which image is more realistic? & Percentage over trial \\
%        \midrule
%        Prefer DRIT over DRIT w/o $D^c$& 69.9 $\pm$ 4.82 \\
%        Prefer DRIT over Cycle/Bicycle& 60.8 $\pm$ 5.13 \\
%        Prefer DRIT over UNIT~\cite{liu2017unit}& 76.7 $\pm$ 4.44 \\
%        Prefer DRIT over CycleGAN~\cite{zhu2017cyclegan}& 42.3 $\pm$ 5.19\\
%        \midrule
%        Prefer DRIT over Real& 25.3 $\pm$ 4.56\\
%        Cycle/Bicycle over Real & 19.6 $\pm$ 4.17\\
%        UNIT over Real & 16.2 $\pm$ 3.87\\
%        CycleGAN over Real & 37.5 $\pm$ 5.08\\
%		\bottomrule
%    \end{tabular}
%\end{table}

\vspace{\paramargin}
\Paragraph{Reconstruction ability.} 
In addition to diversity evaluation, we conduct an experiment on the edge-to-shoes dataset to measure the quality of the disentangled encoding.
%
Our model was trained using unpaired data.
% JB: What's GOOD?
At test time, given a paired data $\{x,y\}$, we can evaluate the quality of content-attribute disentanglement by measuring the reconstruction errors of $y$ with $\hat{y} = G_\mathcal{Y}(E_\mathcal{X}^c(x), E_\mathcal{Y}^a(y))$.

%
We compare our model with BicycleGAN, which requires paired data during training.
%
\tabref{recon} shows our model performs comparably with BicycleGAN despite training without paired data.
%
Moreover, the result suggests that the content discriminator contributes greatly to the quality of disentangled representation.
\vspace{-1mm}
\subsection{Domain Adaptation}
\vspace{-1mm}
We demonstrate that the proposed image-to-image translation scheme can benefit unsupervised domain adaptation.
%
%With labeled images in the source domain, we can obtain new labeled images in the target domain via image-to-image translation.
%
Following PixelDA~\cite{bousmalis2017unsupervisedda}, we conduct experiments on the classification and pose estimation tasks using MNIST~\cite{lecun1998MNIST} to MNIST-M~\cite{ganin2016MNISTM}, and Synthetic Cropped LineMod to Cropped LineMod~\cite{hinterstoisser2012linemod,wohlhart2015croplinemod}.
%
Several example images in these datasets are shown in \figref{da} (a) and (b).
%
To evaluate our method, we first translate the labeled source images to the target domain.
%
We then treat the generated labeled images as training data and train the classifiers of each task in the target domain.
%
For a fair comparison, we use the classifiers with the same architecture as PixelDA.
%
We compare the proposed method with CycleGAN, which generates the most realistic images in the target domain according to our previous experiment, and three state-of-the-art domain adaptation algorithms: PixelDA, DANN~\cite{ganin2016domain} and DSN~\cite{bousmalis2016domain}.
% MMD~\cite{tzeng2014deep,long2015learning},
%-------------------------------------------------------------
\begin{figure*}[t]
	\centering
    \subfloat[Examples from  MNIST/MNIST-M ]{
        \mpage{0.45}{
		     \mpage{0.45}{MNIST}\hfill\mpage{0.45}{MNIST-M}
             \mpage{0.45}{(Source)}\hfill\mpage{0.45}{(Target)}
             \includegraphics[width=\linewidth]{Figures/DA_mnist_example.pdf}
              \vspace{-4mm}
          }
    }
    \hfill
    \subfloat[Examples from Cropped Linemod ]{
        \mpage{0.45}{
		     \mpage{0.45}{Synthetic}\hfill\mpage{0.45}{Real}
             \mpage{0.45}{(Source)}\hfill\mpage{0.45}{(Target)}
             \includegraphics[width=\linewidth]{Figures/DA_linemod_example.pdf}
             \vspace{-4mm}
         }
    }
    \vspace{\subfigmargin}
    
	\subfloat[MNIST $\rightarrow$ MNIST-M]{
        \mpage{0.45}{
		   \mpage{0.15}{Source}\hfill\mpage{0.8}{Generated}
           \includegraphics[width=\linewidth]{Figures/DA_mnist3.pdf}
           \vspace{-4mm}
          }
    }
    \hfill
    \subfloat[Synthetic $\rightarrow$ Real Cropped LineMod]{
        \mpage{0.45}{
		    \mpage{0.15}{Source}\hfill\mpage{0.8}{Generated}
            \includegraphics[width=\linewidth]{Figures/DA_linemod2.pdf}
            \vspace{-4mm}
        }
    }
    \vspace{-1mm}
	\caption{\textbf{Domain adaptation experiments.} We conduct the experiment on (a) MNIST to MNIST-M, and (b) Synthetic to Realistic Cropped LineMod. (c)(d) Our method can generate diverse images that benefit the domain adaptation.
   } 
	\label{figure:da}
    \vspace{\figmargin}
    \vspace{+2mm}
\end{figure*}
%-------------------------------------------------------------
%-------------------------------------------------------------
\begin{table}[t]
	\caption{\textbf{Domain adaptation results}. 
    %
    We report the classification accuracy and the pose estimation error on MNIST to MNIST-M and Synthetic Cropped LineMod to Cropped LineMod. 
    %
    The entries ``Source-only" and ``Target-only" represent that the training uses either image only from the source and target domain. 
    %
    Numbers in parenthesis are reported by PixelDA, which are slightly different from what we obtain.
    \jiabin{Maybe use a footnote to talk about this rather in the table caption.}
    }
	\label{tab:da}
	\centering
	\small
    \subfloat[MNIST-M]{
    \vspace{-2mm}
	\begin{tabular}{l cc} 
    	\toprule
		Model & \makecell{Classification \\ Accuracy ($\%$)}\\
        \midrule
        Source-only & 56.6 \\
        \midrule
        CycleGAN~\cite{zhu2017cyclegan} & 74.5 \\
        Ours, $\times 1$ & 86.93\\
        Ours, $\times 3$ & \underline{90.21}\\
        Ours, $\times 5$ & \textbf{91.54}\\
        %Ours, x11 & 90.54\\
        \midrule
        %MMD~\cite{tzeng2014deep,long2015learning} & 76.9 \\
        DANN~\cite{ganin2016domain} & 77.4 \\
        DSN~\cite{bousmalis2016domain} & \underline{83.2} \\
        PixelDA~\cite{bousmalis2017unsupervisedda} & \textbf{95.9} \\
        \midrule
        Target-only & 96.5 \\
        \bottomrule
	\end{tabular}}
    \vspace{-4mm}
    \qquad
    \subfloat[Cropped LineMod]{
    \vspace{-2mm}
	\begin{tabular}{l cc} 
    	\toprule
		Model & \makecell{Classification \\ Accuracy ($\%$)} & \makecell{Mean Angle \\ Error ($\degree$)}\\
        \midrule
        Source-only & 42.9 (47.33) & 73.7 (89.2) \\
        \midrule
        CycleGAN~\cite{zhu2017cyclegan} & 68.18 & 47.45 \\
        Ours, $\times 1$ & 95.91 & 42.06\\
        Ours, $\times 3$ & \underline{97.04} & \underline{37.35}\\
        Ours, $\times 5$ & \textbf{98.12} & \textbf{34.4}\\
        \midrule
        %MMD~\cite{tzeng2014deep,long2015learning} & 72.35 & 70.62 \\
        DANN~\cite{ganin2016domain} & \underline{99.9} & 56.58 \\
        DSN~\cite{bousmalis2016domain} & \textbf{100} & \underline{53.27} \\
        PixelDA~\cite{bousmalis2017unsupervisedda} & 99.98 &\textbf{23.5} \\ 
        \midrule
        Target-only & 100 &12.3 (6.47) \\
        \bottomrule
	\end{tabular}}
    \vspace{-4mm}
\end{table}
%-------------------------------------------------------------


We present the quantitative comparisons in \tabref{da} and visual results from our method in Figure~\ref{figure:da}(c)(d).
%
Since our model can generate diverse output, we generate one time, three times, and five times (denoted as $\times 1, \times3, \times 5$) of target images using the same amount of source images.
%
Our results validate that the proposed method can simulate diverse images in the target domain and improve the performance in target tasks.
%
While our method does not outperform PixelDA, we note that unlike PixelDA, we do not leverage label information during training.
%
Compared to CycleGAN, our method performs favorably even with the same amount of generated images (\ie $\times 1$).
%
We observe that CycleGAN suffers from the mode collapse problem and generates images with similar appearances, which degrade the performance of the adapted classifiers.



%-------------------------------------------------------------
\begin{figure*}[t]
	\centering
	\subfloat[Summer $\rightarrow$ Winter]{
    \includegraphics[width=0.4\linewidth]{Figures/Failure_1.pdf}
	}
	\subfloat[van Gogh $\rightarrow$ Monet]{
    \includegraphics[width=0.4\linewidth]{Figures/Failure_2.pdf}
	}
    \vspace{\subfigmargin}
    \vspace{-3mm}
   
	\caption{\textbf{Failure Cases.} Typical cases: (a) Attribute space not fully exploited. (b) Distribution characteristic difference. }
	\label{figure:failure}
    \vspace{-5mm}
\end{figure*}
%-------------------------------------------------------------
\vspace{-1mm}
\vspace{\secmargin}
\subsection{Limitations}
\label{subsec:limitation}
\vspace{\secmargin}
%Despite compelling results are shown, the translation is far from perfect.
%
%There are several limitations.
Our method has the following limitations.
%
First, due to the limited amount of training data, the attribute space is not fully exploited.
%
Our I2I translation fails when the sampled attribute vectors locate in under-sampled space, see \figref{failure}(a).
%
Second, it remains difficult when the domain characteristics differ significantly.
%
For example, \figref{failure}(b) shows a failure case on the human figure due to the lack of human-related portraits in Monet collections.
%
\vspace{-1mm}
\section{Conclusions}
\label{sec:conclusion}
\vspace{\secmargin}
In this paper, we present a novel disentangled representation framework for diverse image-to-image translation with unpaired data.
%
we propose to disentangle the latent space to a content space that encodes common information between domains, and a domain-specific attribute space that can model the diverse variations given the same content.
%
We apply a content discriminator to facilitate the representation disentanglement.
%
We propose a cross-cycle consistency loss for cyclic reconstruction to train in the absence of paired data.
%
Qualitative and quantitative results show that the proposed model produces realistic and diverse images.
%
We also apply the proposed method to domain adaptation and achieve competitive performance compared to the state-of-the-art methods.
%
\vspace{-1mm}
\section*{Acknowledgements}
\vspace{-3mm}
This work is supported in part by the NSF CAREER Grant \#1149783, the NSF Grant \#1755785, and gifts from Verisk, Adobe and Nvidia.

\clearpage

\bibliographystyle{splncs04}
\bibliography{eccv18}
\end{document}